//
// Protocol buffers definition for dgs server
//
syntax = "proto3";
package pt.tecnico.staysafe.dgs.grpc;

option java_multiple_files = true;

import "google/protobuf/timestamp.proto";


//function sniffer_join
//
message SnifferJoinRequest {
	string name = 1;
	string address = 2;
	int32 replicaId = 3;
}

message SnifferJoinResponse {
	string success = 1;
	repeated int64 ts = 2;
}


//function sniffer_info
//
message SnifferInfoRequest {
	string name = 1;
	int32 replicaId = 2;
}

message SnifferInfoResponse {
	string nameAddress = 1;
	repeated int64 ts = 2;
}


//function report
//
message ReportRequest {
	string name = 1;
	string infection = 2;
	int64 id = 3;
	google.protobuf.Timestamp timeIn = 4;
	google.protobuf.Timestamp timeOut = 5;
	int32 replicaId = 6;
}

message ReportResponse {
	string success = 1;
	repeated int64 ts = 2;
}


//function individual_infection_probability
//
message IndividualProbRequest {
	int64 id = 1;
	int32 replicaId = 2;
}

message IndividualProbResponse {
	float prob = 1;
	repeated int64 ts = 2;
}


//function aggregate_infection_probability
//
message AggregateProbRequest {
	string command = 1;
	int32 replicaId = 2;
}

message AggregateProbResponse {
	repeated float stat = 1;
	repeated int64 ts = 2;
}


//function ctrlPing
//
message PingRequest {
	string text = 1;
	int32 replicaId = 2;
}

message PingResponse {
	string text = 1;
	repeated int64 ts = 2;
}


//function ctrlInit
//
message InitRequest {
	string snifferName = 1;
	string infection = 2;
	int64 id = 3;
	google.protobuf.Timestamp timeIn = 4;
	google.protobuf.Timestamp timeOut = 5;
	int32 replicaId = 6;
}

message InitResponse {
	string success = 1;
}


//function ctrlClear
//
message ClearRequest {
	int32 replicaId = 1;
}

message ClearResponse {
	string success = 1;
	repeated int64 ts = 2;
}


service Dgs {
	rpc sniffer_join(SnifferJoinRequest) returns (SnifferJoinResponse);
	rpc sniffer_info(SnifferInfoRequest) returns (SnifferInfoResponse);
	rpc report(ReportRequest) returns (ReportResponse);
	rpc individual_infection_probability(IndividualProbRequest) returns (IndividualProbResponse);
	rpc aggregate_infection_probability(AggregateProbRequest) returns (AggregateProbResponse);
	rpc ctrl_ping(PingRequest) returns (PingResponse);
	rpc ctrl_init(InitRequest) returns (InitResponse);
	rpc ctrl_clear(ClearRequest) returns (ClearResponse);
}